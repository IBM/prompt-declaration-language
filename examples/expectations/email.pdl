description: Hello world calling a model
defs:
  feedback: 
    function:
      expectation: string
      response: string
    return:
      lastOf:
      - model: ollama_chat/mistral-small:latest 
        def: result
        input: |
          Does the following email end with Kind regards. Answer with a JSON object and a result field with value True or False only.
          Email: ${ response }
        parser: json
      - if: ${ not(result.result) }
        then:
          model: ollama_chat/mistral-small:latest 
          def: instruction
          input: |
            A model responded with the following response: ${ response }
            In order to satisfy the following expectation: ${ expectation }
            what should be added to the prompt as an instruction?

            Respond with only with the instruction.

  notes: Olivia helped the lab over the last few weeks by organizing intern events, advertising the speaker series, and handling issues with snack delivery.
  name: Olivia
lastOf:
- "Write an email to ${ name } using the notes following: ${ notes }"
- model: ollama_chat/granite3.2:2b
  expectations:
  - expect: The email should end with Kind regards
    feedback:  ${ feedback }
  retry: 1
