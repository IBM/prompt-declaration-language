description: Code explanation example
defs:
  # The variable `CODE` shall be the contents of the parsed YAML file
  CODE:
    read: ./data.yaml
    parser: yaml
  # The variable `TRUTH` shall be the text of the file
  TRUTH:
    read: ./ground_truth.txt
  # Use replicate.com to invoke a Granite model with a prompt.
  EXPLANATION:
    model: replicate/ibm-granite/granite-3.0-8b-instruct
    input: |
        Here is some info about the location of the function in the repo.
        repo: 
        ${ CODE.repo_info.repo }
        path: ${ CODE.repo_info.path }
        Function_name: ${ CODE.repo_info.function_name }


        Explain the following code:
        ```
        ${ CODE.source_code }```
    parameters:
      # Use no LLM creativity.  (Note that 0 is the default; this line has no effect)
      temperature: 0

text:
# Print the source code to the console
- |
  ${ CODE.source_code }
  ${ EXPLANATION }


  EVALUATION:
  The similarity (Levenshtein) between this answer and the ground truth is:
- lang: python
  # (Use `pip install textdistance` if needed to install the textdistance package)
  code: |
    import textdistance
    expl = """
    ${ EXPLANATION }
    """
    truth = """
    ${ TRUTH }
    """
    # (In PDL, set `result` to the output you wish for your code block.)
    result = textdistance.levenshtein.normalized_similarity(expl, truth)
